import{aP as jn,r as c,aQ as yt,aR as Pn,aD as En,b as ne,j as o,aS as Fe,aT as Ht,F as A,h as he,aU as me,aV as it,aW as Sn,aX as bt,aY as kn,i as Z,o as B,t as Re,T as O,B as ue,aZ as Cn,a_ as _n,a$ as Rn,b0 as In,b1 as xt,b2 as $n,b3 as wt,b4 as Tn,b5 as Oe,S as fe,b6 as jt,b7 as Dn,b8 as On,b9 as Ln,n as Pt,p as Le,m as Ae,a3 as Kt,ba as An,Z as at,bb as qt,bc as zn,bd as Mn,be as Je,aa as Un,bf as Wn,bg as Nn,bh as Fn,k as Bn,I as Vn,bi as Hn,bj as Kn,bk as qn,bl as Jt,bm as Jn,s as Gn,bn as Xn,f as Zn,u as ze,bo as Me,bp as et,w as Yn,bq as Qn,br as er,bs as ot,aH as Gt,a6 as tr,bt as nr,bu as rr,bv as ir,bw as ar,bx as or,aw as sr,z as cr,by as ur,ac as Xt,ae as Zt,bz as lr,am as dr,bA as pr,bB as fr}from"./sanity-8654a3cc.js";import{H as hr,c as mr}from"./DisplayedDocumentBroadcaster-67147568.js";function vr({children:e,isValidProp:n,...t}){n&&jn(n),t={...c.useContext(yt),...t},t.isStatic=Pn(()=>t.isStatic);const i=c.useMemo(()=>t,[JSON.stringify(t.transition),t.transformPagePoint,t.reducedMotion]);return c.createElement(yt.Provider,{value:i},e)}const gr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,st=/_key\s*==\s*['"](.*)['"]/,yr=/^\d*:\d*$/;function ct(e){return typeof e=="number"||typeof e=="string"&&/^\[\d+\]$/.test(e)}function Be(e){return typeof e=="string"?st.test(e.trim()):typeof e=="object"&&"_key"in e}function Yt(e){if(typeof e=="string"&&yr.test(e))return!0;if(!Array.isArray(e)||e.length!==2)return!1;const[n,t]=e;return(typeof n=="number"||n==="")&&(typeof t=="number"||t==="")}function br(e,n,t){const i=typeof n=="string"?Qt(n):n;if(!Array.isArray(i))throw new Error("Path must be an array or a string");let r=e;for(let a=0;a<i.length;a++){const u=i[a];if(ct(u)){if(!Array.isArray(r))return t;r=r[u]}if(Be(u)){if(!Array.isArray(r))return t;r=r.find(m=>m._key===u._key)}if(typeof u=="string"&&(r=typeof r=="object"&&r!==null?r[u]:void 0),typeof r>"u")return t}return r}function xr(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce((n,t,i)=>{const r=typeof t;if(r==="number")return`${n}[${t}]`;if(r==="string")return`${n}${i===0?"":"."}${t}`;if(Be(t)&&t._key)return`${n}[_key=="${t._key}"]`;if(Array.isArray(t)){const[a,u]=t;return`${n}[${a}:${u}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(t)}\``)},"")}function Qt(e){if(typeof e!="string")throw new Error("Path is not a string");const n=e.match(gr);if(!n)throw new Error("Invalid path string");return n.map(wr)}function wr(e){return ct(e)?jr(e):Be(e)?Pr(e):Yt(e)?Er(e):e}function jr(e){return Number(e.replace(/[^\d]/g,""))}function Pr(e){return{_key:e.match(st)[1]}}function Er(e){const[n,t]=e.split(":").map(i=>i===""?i:Number(i));return[n,t]}var en=Object.freeze({__proto__:null,fromString:Qt,get:br,isIndexSegment:ct,isIndexTuple:Yt,isKeySegment:Be,reKeySegment:st,toString:xr});const Et="drafts.";function fa(e){return e.startsWith(Et)?e.slice(Et.length):e}const St={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},kt={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function Sr(e){return`$${e.map(n=>typeof n=="string"?`['${n.replace(/[\f\n\r\t'\\]/g,t=>St[t])}']`:typeof n=="number"?`[${n}]`:n._key!==""?`[?(@._key=='${n._key.replace(/['\\]/g,t=>St[t])}')]`:`[${n._index}]`).join("")}`}function ha(e){const n=[],t=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let i;for(;(i=t.exec(e))!==null;){if(i[1]!==void 0){const r=i[1].replace(/\\(\\|f|n|r|t|')/g,a=>kt[a]);n.push(r);continue}if(i[2]!==void 0){n.push(parseInt(i[2],10));continue}if(i[3]!==void 0){const r=i[3].replace(/\\(\\')/g,a=>kt[a]);n.push({_key:r,_index:-1});continue}}return n}function kr(e){return e.map(n=>{if(typeof n=="string"||typeof n=="number")return n;if(n._index!==-1)return n._index;throw new Error(`invalid segment:${JSON.stringify(n)}`)})}function ma(e,n){if(!(n!=null&&n.mappings))return;const t=Sr(kr(e));if(n.mappings[t]!==void 0)return{mapping:n.mappings[t],matchedPath:t,pathSuffix:""};const i=Object.entries(n.mappings).filter(([m])=>t.startsWith(m)).sort(([m],[p])=>p.length-m.length);if(i.length==0)return;const[r,a]=i[0],u=t.substring(r.length);return{mapping:a,matchedPath:r,pathSuffix:u}}function Cr(e){return e!==null&&Array.isArray(e)}function Ct(e){return typeof e=="object"&&e!==null}function Ge(e,n,t=[]){return Cr(e)?e.map((i,r)=>{if(Ct(i)){const a=i._key;if(typeof a=="string")return Ge(i,n,t.concat({_key:a,_index:r}))}return Ge(i,n,t.concat(r))}):Ct(e)?Object.fromEntries(Object.entries(e).map(([i,r])=>[i,Ge(r,n,t.concat(i))])):n(e,t)}const tn="sanity.previewUrlSecret",_r="sanity-preview-url-secret",Rr="2023-11-09",Ve="sanity-preview-secret",ut="sanity-preview-pathname",Ir=3600,$r=`*[_type == "${tn}" && dateTime(_updatedAt) <= dateTime(now()) - 3600]`,Tr="sanity.preview-url-secret";function Dr(e){const n=new URL(e);return n.searchParams.delete(ut),n.searchParams.delete(Ve),n}function Or(e){return e.searchParams.has(Ve)}function Lr(e,n,t){const i=new URL(e);return i.searchParams.set(Ve,n),i.searchParams.set(ut,t),i}async function nn(e,n,t,i,r=En()){const a=e.withConfig({apiVersion:Rr});try{const u=new Date(Date.now()+1e3*Ir),m=`${_r}.${r}`,p=function(){if(typeof crypto<"u"){const l=new Uint8Array(16);crypto.getRandomValues(l);let s="";for(let d=0;d<l.length;d++)s+=l[d].toString(16).padStart(2,"0");return s=btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]+$/,""),s}return Math.random().toString(36).slice(2)}(),y=a.patch(m).set({secret:p,source:n,studioUrl:t,userId:i});return await a.transaction().createOrReplace({_id:m,_type:tn}).patch(y).commit({tag:Tr}),{secret:p,expiresAt:u}}finally{await a.delete({query:$r})}}function Ar(e){for(var n=[],t=0;t<e.length;){var i=e[t];if(i==="*"||i==="+"||i==="?"){n.push({type:"MODIFIER",index:t,value:e[t++]});continue}if(i==="\\"){n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});continue}if(i==="{"){n.push({type:"OPEN",index:t,value:e[t++]});continue}if(i==="}"){n.push({type:"CLOSE",index:t,value:e[t++]});continue}if(i===":"){for(var r="",a=t+1;a<e.length;){var u=e.charCodeAt(a);if(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||u===95){r+=e[a++];continue}break}if(!r)throw new TypeError("Missing parameter name at ".concat(t));n.push({type:"NAME",index:t,value:r}),t=a;continue}if(i==="("){var m=1,p="",a=t+1;if(e[a]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(a));for(;a<e.length;){if(e[a]==="\\"){p+=e[a++]+e[a++];continue}if(e[a]===")"){if(m--,m===0){a++;break}}else if(e[a]==="("&&(m++,e[a+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(a));p+=e[a++]}if(m)throw new TypeError("Unbalanced pattern at ".concat(t));if(!p)throw new TypeError("Missing pattern at ".concat(t));n.push({type:"PATTERN",index:t,value:p}),t=a;continue}n.push({type:"CHAR",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}function zr(e,n){n===void 0&&(n={});for(var t=Ar(e),i=n.prefixes,r=i===void 0?"./":i,a="[^".concat(ye(n.delimiter||"/#?"),"]+?"),u=[],m=0,p=0,y="",l=function(S){if(p<t.length&&t[p].type===S)return t[p++].value},s=function(S){var x=l(S);if(x!==void 0)return x;var C=t[p],T=C.type,R=C.index;throw new TypeError("Unexpected ".concat(T," at ").concat(R,", expected ").concat(S))},d=function(){for(var S="",x;x=l("CHAR")||l("ESCAPED_CHAR");)S+=x;return S};p<t.length;){var h=l("CHAR"),v=l("NAME"),b=l("PATTERN");if(v||b){var f=h||"";r.indexOf(f)===-1&&(y+=f,f=""),y&&(u.push(y),y=""),u.push({name:v||m++,prefix:f,suffix:"",pattern:b||a,modifier:l("MODIFIER")||""});continue}var w=h||l("ESCAPED_CHAR");if(w){y+=w;continue}y&&(u.push(y),y="");var j=l("OPEN");if(j){var f=d(),P=l("NAME")||"",g=l("PATTERN")||"",E=d();s("CLOSE"),u.push({name:P||(g?m++:""),pattern:P&&!g?a:g,prefix:f,suffix:E,modifier:l("MODIFIER")||""});continue}s("END")}return u}function Mr(e,n){var t=[],i=an(e,t,n);return Ur(i,t,n)}function Ur(e,n,t){t===void 0&&(t={});var i=t.decode,r=i===void 0?function(a){return a}:i;return function(a){var u=e.exec(a);if(!u)return!1;for(var m=u[0],p=u.index,y=Object.create(null),l=function(d){if(u[d]===void 0)return"continue";var h=n[d-1];h.modifier==="*"||h.modifier==="+"?y[h.name]=u[d].split(h.prefix+h.suffix).map(function(v){return r(v,h)}):y[h.name]=r(u[d],h)},s=1;s<u.length;s++)l(s);return{path:m,index:p,params:y}}}function ye(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function rn(e){return e&&e.sensitive?"":"i"}function Wr(e,n){if(!n)return e;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,i=0,r=t.exec(e.source);r;)n.push({name:r[1]||i++,prefix:"",suffix:"",modifier:"",pattern:""}),r=t.exec(e.source);return e}function Nr(e,n,t){var i=e.map(function(r){return an(r,n,t).source});return new RegExp("(?:".concat(i.join("|"),")"),rn(t))}function Fr(e,n,t){return Br(zr(e,t),n,t)}function Br(e,n,t){t===void 0&&(t={});for(var i=t.strict,r=i===void 0?!1:i,a=t.start,u=a===void 0?!0:a,m=t.end,p=m===void 0?!0:m,y=t.encode,l=y===void 0?function(R){return R}:y,s=t.delimiter,d=s===void 0?"/#?":s,h=t.endsWith,v=h===void 0?"":h,b="[".concat(ye(v),"]|$"),f="[".concat(ye(d),"]"),w=u?"^":"",j=0,P=e;j<P.length;j++){var g=P[j];if(typeof g=="string")w+=ye(l(g));else{var E=ye(l(g.prefix)),S=ye(l(g.suffix));if(g.pattern)if(n&&n.push(g),E||S)if(g.modifier==="+"||g.modifier==="*"){var x=g.modifier==="*"?"?":"";w+="(?:".concat(E,"((?:").concat(g.pattern,")(?:").concat(S).concat(E,"(?:").concat(g.pattern,"))*)").concat(S,")").concat(x)}else w+="(?:".concat(E,"(").concat(g.pattern,")").concat(S,")").concat(g.modifier);else g.modifier==="+"||g.modifier==="*"?w+="((?:".concat(g.pattern,")").concat(g.modifier,")"):w+="(".concat(g.pattern,")").concat(g.modifier);else w+="(?:".concat(E).concat(S,")").concat(g.modifier)}}if(p)r||(w+="".concat(f,"?")),w+=t.endsWith?"(?=".concat(b,")"):"$";else{var C=e[e.length-1],T=typeof C=="string"?f.indexOf(C[C.length-1])>-1:C===void 0;r||(w+="(?:".concat(f,"(?=").concat(b,"))?")),T||(w+="(?=".concat(f,"|").concat(b,")"))}return new RegExp(w,rn(t))}function an(e,n,t){return e instanceof RegExp?Wr(e,n):Array.isArray(e)?Nr(e,n,t):Fr(e,n,t)}function Vr(e){const{draftMode:n,previewMode:t,origin:i=typeof location>"u"?"https://localhost":location.origin}=e,r=(t==null?void 0:t.enable)||(n==null?void 0:n.enable);let{preview:a="/"}=e;const u=new URL(a,i),m=r?new URL(r,i):void 0;return async p=>{try{if(p.previewSearchParam){const l=new URL(p.previewSearchParam,u);l.origin===u.origin&&(a=`${l.pathname}${l.search}`)}else if(p.referrer){const l=new URL(p.referrer);l.origin===u.origin&&(a=`${l.pathname}${l.search}`)}}catch{}typeof location<"u"&&location.origin===u.origin&&p.studioBasePath&&(a.startsWith(`${p.studioBasePath}/`)||a===p.studioBasePath)&&(a=e.preview||"/");const y=new URL(a,u);if(m){const l=new URL(m),{searchParams:s}=l;return s.set(Ve,p.previewUrlSecret),y.pathname!==l.pathname&&s.set(ut,`${y.pathname}${y.search}`),l.toString()}return y.toString()}}const Hr=e=>typeof e=="object"&&typeof e.then=="function",Ie=[];function Kr(e,n,t=(i,r)=>i===r){if(e===n)return!0;if(!e||!n)return!1;const i=e.length;if(n.length!==i)return!1;for(let r=0;r<i;r++)if(!t(e[r],n[r]))return!1;return!0}function qr(e,n=null,t=!1,i={}){n===null&&(n=[e]);for(const a of Ie)if(Kr(n,a.keys,a.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return i.lifespan&&i.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,i.lifespan)),a.response;if(!t)throw a.promise}const r={keys:n,equal:i.equal,remove:()=>{const a=Ie.indexOf(r);a!==-1&&Ie.splice(a,1)},promise:(Hr(e)?e:e(...n)).then(a=>{r.response=a,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(a=>r.error=a)};if(Ie.push(r),!t)throw r.promise}const _t=(e,n,t)=>qr(e,n,!1,t);var Jr=Object.defineProperty,Gr=(e,n,t)=>((i,r,a)=>r in i?Jr(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a)(e,typeof n!="symbol"?n+"":n,t);let $e;const Xr=new Uint8Array(16);function Zr(){if(!$e&&($e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $e(Xr)}const U=[];for(let e=0;e<256;++e)U.push((e+256).toString(16).slice(1));var Rt={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function De(e,n,t){if(Rt.randomUUID&&!n&&!e)return Rt.randomUUID();const i=(e=e||{}).random||(e.rng||Zr)();return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(r,a=0){return U[r[a+0]]+U[r[a+1]]+U[r[a+2]]+U[r[a+3]]+"-"+U[r[a+4]]+U[r[a+5]]+"-"+U[r[a+6]]+U[r[a+7]]+"-"+U[r[a+8]]+U[r[a+9]]+"-"+U[r[a+10]]+U[r[a+11]]+U[r[a+12]]+U[r[a+13]]+U[r[a+14]]+U[r[a+15]]}(i)}const Yr=1e3,Qr=1e3,ei=500,ti=["handshake/syn","handshake/syn-ack","handshake/ack"],It=e=>ti.some(n=>n===e),ni=({data:e={}})=>typeof e=="object"&&e!==null&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every(n=>n in e)&&e.type.startsWith("handshake/");function $t(e){const n=e.target,t=e.connectTo.map(s=>({buffer:[],config:s,id:"",handler:r,status:"connecting",interval:void 0,heartbeat:void 0}));function i(s){window.clearInterval(s.interval)}function r(s){const{data:d}=s;if(It(d.type)){const h=t.find(v=>v.config.id===d.from);h&&d.type==="handshake/syn-ack"&&(p(h,"connected"),y(h,"handshake/ack",{id:h.id}))}}const a=s=>{var d,h,v;const b=s.data;if(!It(b.type)&&t.find(f=>f.id===b.connectionId)){const f=t.find(w=>w.config.id===b.from);if(f){const w=[b.type,b.data];(h=(d=f.config).onEvent)==null||h.call(d,...w),(v=e.onEvent)==null||v.call(e,...w),l(f,"channel/response",{responseTo:b.id},!1)}}};function u(s){var d;if(ni(s))console.error(`Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:
https://github.com/sanity-io/visual-editing`);else if(function(h){const{data:v,origin:b}=h;return v.domain==="sanity/channels"&&v.to==e.id&&t.map(f=>f.config.id).includes(v.from)&&v.type!=="channel/response"&&b===e.targetOrigin}(s)){const{data:h}=s;(d=t.find(v=>v.config.id===h.from))==null||d.handler(s)}}function m(s){s.heartbeat&&window.clearInterval(s.heartbeat)}function p(s,d){var h,v,b;s.status=d,(v=(h=s.config).onStatusUpdate)==null||v.call(h,d,s.config.id),(b=e.onStatusUpdate)==null||b.call(e,d,s.config.id),d==="connecting"||d==="reconnecting"?(s.handler=r,m(s),function(f){f.id=De(),f.interval=window.setInterval(()=>{y(f,"handshake/syn",{id:f.id})},ei)}(s)):d==="connected"?(s.handler=a,i(s),function(f){if(m(f),f.config.heartbeat){const w=typeof f.config.heartbeat=="number"?f.config.heartbeat:Qr;f.heartbeat=window.setInterval(()=>{l(f,"channel/heartbeat")},w)}}(s),function(f){const w=[...f.buffer];f.buffer.splice(0,f.buffer.length),w.forEach(({type:j,data:P})=>{l(f,j,P)})}(s)):d==="disconnected"&&(s.id=null,s.handler=r,i(s),m(s))}function y(s,d,h){if(!s.id)throw new Error("No channel ID set");const v={connectionId:s.id,data:h,domain:"sanity/channels",from:e.id,id:De(),to:s.config.id,type:d};try{n==null||n.postMessage(v,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${v.id}' on '${e.id}'`)}}function l(s,d,h,v=!0){const b=De();if(s.status==="connecting"||s.status==="reconnecting"||s.status==="disconnected")return void s.buffer.push({type:d,data:h});if(!s.id)throw new Error("No channel ID set");const f={connectionId:s.id,data:h,domain:"sanity/channels",from:e.id,id:b,to:s.config.id,type:d};if(v){const w=setTimeout(()=>{f.connectionId===s.id&&(window.removeEventListener("message",j,!1),d!=="channel/heartbeat"&&s.buffer.push({type:d,data:h}),p(s,"reconnecting"),console.warn(`Received no response to message '${f.type}' on client '${e.id}' (ID: '${f.id}').`))},Yr),j=P=>{var g;const{data:E}=P;E.type==="channel/response"&&(g=E.data)!=null&&g.responseTo&&E.data.responseTo===f.id&&(window.removeEventListener("message",j,!1),clearTimeout(w))};window.addEventListener("message",j,!1)}try{n==null||n.postMessage(f,{targetOrigin:e.targetOrigin})}catch{throw new Error(`Failed to postMessage '${f.id}' on client '${e.id}'`)}}return window.addEventListener("message",u,!1),t.forEach(s=>{p(s,"connecting")}),{destroy:function(){t.forEach(s=>{["disconnected"].includes(s.status)||(l(s,"channel/disconnect",{id:s.id},!1),p(s,"disconnected"))}),window.removeEventListener("message",u,!1),t.forEach(s=>{m(s),i(s)})},send:function(s,d,h){(s?Array.isArray(s)?[...s]:[s]:t).forEach(v=>{const b=t.find(f=>f.config.id===v);if(!b)throw new Error("Invalid channel ID");l(b,d,h)})}}}function on(e){var n,t,i;let r=typeof e;return r==="object"&&(r=(i=e&&((t=(n=Object.getPrototypeOf(e))==null?void 0:n.constructor)==null?void 0:t.name))!=null?i:"null"),r==="string"?`"${e}"`:r==="number"||r==="bigint"||r==="boolean"?`${e}`:r}function we(e,n,t,i,r){var a,u,m,p,y,l;const s=r&&"input"in r?r.input:t.value,d=(a=r==null?void 0:r.expected)!=null?a:e.expects,h=(u=r==null?void 0:r.received)!=null?u:on(s),v={kind:e.kind,type:e.type,input:s,expected:d,received:h,message:`Invalid ${n}: ${d?`Expected ${d} but r`:"R"}eceived ${h}`,requirement:e.requirement,path:r==null?void 0:r.path,issues:r==null?void 0:r.issues,lang:i.lang,abortEarly:i.abortEarly,abortPipeEarly:i.abortPipeEarly,skipPipe:i.skipPipe},b=e.kind==="schema",f=(l=(y=(p=(m=e.message)!=null?m:function(w,j){var P;return(P=void 0)==null?void 0:P.get(j)}(e.reference,v.lang))!=null?p:b?(v.lang,void 0):null)!=null?y:i.message)!=null?l:function(w){}(v.lang);f&&(v.message=typeof f=="function"?f(v):f),b&&(t.typed=!1),t.issues?t.issues.push(v):t.issues=[v]}function ri(e){return e!=="__proto__"&&e!=="prototype"&&e!=="constructor"}var ii=class extends Error{constructor(e){super(e[0].message),Gr(this,"issues"),this.name="ValiError",this.issues=e}};function ai(e,n,t){return typeof e.fallback=="function"?e.fallback(n,t):e.fallback}function lt(e){return{kind:"schema",type:"boolean",reference:lt,expects:"boolean",async:!1,message:e,_run(n,t){return typeof n.value=="boolean"?n.typed=!0:we(this,"type",n,t),n}}}function xe(e,n){return{kind:"schema",type:"object",reference:xe,expects:"Object",async:!1,entries:e,message:n,_run(t,i){var r;const a=t.value;if(a&&typeof a=="object"){t.typed=!0,t.value={};for(const u in this.entries){const m=a[u],p=this.entries[u]._run({typed:!1,value:m},i);if(p.issues){const y={type:"object",origin:"value",input:a,key:u,value:m};for(const l of p.issues)l.path?l.path.unshift(y):l.path=[y],(r=t.issues)==null||r.push(l);if(t.issues||(t.issues=p.issues),i.abortEarly){t.typed=!1;break}}p.typed||(t.typed=!1),(p.value!==void 0||u in a)&&(t.value[u]=p.value)}}else we(this,"type",t,i);return t}}}function Ue(e,...n){const t={kind:"schema",type:"optional",reference:Ue,expects:`${e.expects} | undefined`,async:!1,wrapped:e,_run(i,r){return i.value===void 0&&("default"in this&&(i.value=function(a,u,m){return typeof a.default=="function"?a.default(u,m):a.default}(this,i,r)),i.value===void 0)?(i.typed=!0,i):this.wrapped._run(i,r)}};return 0 in n&&(t.default=n[0]),t}function We(e){return{kind:"schema",type:"string",reference:We,expects:"string",async:!1,message:e,_run(n,t){return typeof n.value=="string"?n.typed=!0:we(this,"type",n,t),n}}}function oi(e,n,t){const i=e._run({typed:!1,value:n},function(r){var a,u,m;return{lang:(a=r==null?void 0:r.lang)!=null?a:void 0,message:r==null?void 0:r.message,abortEarly:(u=r==null?void 0:r.abortEarly)!=null?u:void 0,abortPipeEarly:(m=r==null?void 0:r.abortPipeEarly)!=null?m:void 0,skipPipe:r==null?void 0:r.skipPipe}}(t));if(i.issues)throw new ii(i.issues);return i.value}const si=/^([A-Za-z]+):([0-9]+)$/,ci=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,ui=/^([A-Za-z]+):([a-z0-9]+)$/,be=function(...e){return{...e[0],pipe:e,_run(n,t){for(let i=0;i<e.length;i++){n=e[i]._run(n,t);const r=e[i+1];if(t.skipPipe||n.issues&&(t.abortEarly||t.abortPipeEarly||(r==null?void 0:r.kind)==="schema"||(r==null?void 0:r.kind)==="transformation")){n.typed=!1;break}}return n}}}(We(),function e(n,t){return{kind:"validation",type:"min_length",reference:e,async:!1,expects:`>=${n}`,requirement:n,message:t,_run(i,r){return i.typed&&i.value.length<this.requirement&&we(this,"length",i,r,{received:`${i.value.length}`}),i}}}(1)),Se=Ue(be);function li(e,n){return`${e}-${typeof n=="string"?n:JSON.stringify(n)}`}xe({baseUrl:be,dataset:Se,id:be,path:be,projectId:Se,tool:Se,type:Se,workspace:Se,isDraft:Ue(We())}),xe({origin:be,href:be,data:Ue(function e(n,t,i){return{kind:"schema",type:"record",reference:e,expects:"Object",async:!1,key:n,value:t,message:i,_run(r,a){var u,m;const p=r.value;if(p&&typeof p=="object"){r.typed=!0,r.value={};for(const y in p)if(ri(y)){const l=p[y],s=this.key._run({typed:!1,value:y},a);if(s.issues){const h={type:"record",origin:"key",input:p,key:y,value:l};for(const v of s.issues)v.path=[h],(u=r.issues)==null||u.push(v);if(r.issues||(r.issues=s.issues),a.abortEarly){r.typed=!1;break}}const d=this.value._run({typed:!1,value:l},a);if(d.issues){const h={type:"record",origin:"value",input:p,key:y,value:l};for(const v of d.issues)v.path?v.path.unshift(h):v.path=[h],(m=r.issues)==null||m.push(v);if(r.issues||(r.issues=d.issues),a.abortEarly){r.typed=!1;break}}(!s.typed||!d.typed)&&(r.typed=!1),s.typed&&(r.value[s.value]=d.value)}}else we(this,"type",r,a);return r}}}(We(),function e(){return{kind:"schema",type:"unknown",reference:e,expects:"unknown",async:!1,_run:n=>(n.typed=!0,n)}}()))});const Tt={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Dt(e){return e.key==="Alt"}function sn(e,n){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{e.apply(e,i)},n)}}const He=c.createContext(null);He.displayName="PanelsContext";const di=ne.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,dt=function({children:e,defaultSize:n=null,id:t,minWidth:i,maxWidth:r,order:a=0}){const u=c.useContext(He);if(u===null)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:m,registerElement:p,unregisterElement:y}=u,l=m(t);return c.useLayoutEffect(()=>(p(t,{id:t,type:"panel",defaultSize:n,maxWidth:r??null,minWidth:i??0,order:a}),()=>{y(t)}),[t,n,a,r,i,p,y]),o.jsx(di,{style:l,children:e})},cn="presentation/panels",Ot=()=>JSON.parse(localStorage.getItem(cn)||"{}"),Lt=e=>e.map(n=>[n.id,n.order].join(":")).join(",");function pi(){return c.useMemo(()=>{const e=(n,t)=>{const i=Ot(),r=Lt(n);(a=>{localStorage.setItem(cn,JSON.stringify(a))})({...i,[r]:t})};return{get:n=>{const t=Ot(),i=Lt(n);return Array.isArray(t[i])&&t[i].some(r=>r===null)?void 0:t[i]},set:e,setDebounced:sn(e,100)}},[])}function tt(e,n,t){const{maxWidth:i,minWidth:r}=e,a=i==null?100:i/t*100,u=r/t*100;return Math.min(a,Math.max(u,n))}function fi(e,n,t){if(e.length===1)return"100";const i=t[e.findIndex(r=>r.id===n)];return i==null?"0":i.toPrecision(10)}function At(e,n,t=0,i=null){return e.clientX-(i||n.getBoundingClientRect()).left-t}function Xe(e){return e.type==="panel"}function zt(e){return e.type==="resizer"}function Mt(e){return Array.from(e.values()).sort(({order:n},{order:t})=>n==null&&t==null?0:n==null?-1:t==null?1:n-t)}function Ut(e,n,t){const i=n.reduce((u,m)=>u+m,0),r=[...n].map(u=>u/i*100);let a=0;for(let u=0;u<e.length;u++){const m=e[u],p=r[u],y=tt(m,p,t);p!=y&&(a+=p-y,r[u]=y)}if(a.toFixed(3)!=="0.000")for(let u=0;u<e.length;u++){const m=e[u];let{maxWidth:p,minWidth:y}=m;y=y/t*100,p!=null&&(p=p/t*100);const l=Math.min(p??100,Math.max(y,r[u]+a));if(l!==r[u]&&(a-=l-r[u],r[u]=l,Math.abs(a).toFixed(3)==="0.000"))break}return r}const hi=ne.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,mi=function({children:e}){const n=c.useRef(null),[t,i]=c.useState(new Map),r=c.useMemo(()=>Mt(t).filter(Xe),[t]),[a,u]=c.useState([]),[m,p]=c.useState(null),y=c.useRef({elements:t,panels:r,widths:a}),l=c.useCallback(P=>({flexGrow:fi(r,P,a),pointerEvents:m===null?void 0:"none"}),[m,r,a]),s=c.useCallback((P,g)=>{i(E=>{if(E.has(P))return E;const S=new Map(E);return S.set(P,g),S})},[]),d=c.useCallback(P=>{i(g=>{if(!g.has(P))return g;const E=new Map(g);return E.delete(P),E})},[]),h=c.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=c.useCallback((P,g)=>{const E=Mt(t),S=E.findIndex(T=>T.id===P),x=t.get(P);if(!x||!zt(x))return;const C=x.el.current;C&&(h.current={resizerIndex:S,panelBefore:E.reduce((T,R,D)=>Xe(R)&&D<S?R:T,null),panelAfter:E.reduce((T,R,D)=>T===null&&Xe(R)&&D>S?R:T,null),containerWidth:window.innerWidth,startX:g.pageX,dragOffset:At(g,C),resizerRect:C.getBoundingClientRect(),widths:y.current.widths},p(P))},[t]),b=c.useCallback(()=>{p(null)},[]),f=c.useCallback((P,g)=>{g.preventDefault(),g.stopPropagation();const{containerWidth:E,dragOffset:S,panelBefore:x,panelAfter:C,resizerRect:T}=h.current;if(x==null||C==null)return;const R=t.get(P);if(!R||!zt(R))return;const D=R.el.current;if(!D)return;const Y=At(g,D,S,T);if(Y===0)return;const{widths:W}=y.current,ve=function(z,Q,re,ee,te,le){const{panels:H,widths:oe}=te,{widths:ge}=le,q=ge||oe,se=[...q];{const J=z<0?ee:re,ie=q[H.findIndex(ke=>ke.id===J.id)],ce=tt(J,ie+Math.abs(z),Q);if(ie===ce)return q;z=z<0?ie-ce:ce-ie}let V=0,N=z<0?re:ee,F=H.findIndex(J=>J.id===N.id);for(;;){const J=H[F],ie=q[F],ce=tt(J,ie-(Math.abs(z)-Math.abs(V)),Q);if(ie!==ce&&(V+=ie-ce,se[F]=ce,V.toPrecision(10).localeCompare(Math.abs(z).toPrecision(10),void 0,{numeric:!0})>=0))break;if(z<0){if(--F<0)break}else if(++F>=H.length)break}return V===0?q:(N=z<0?ee:re,F=H.findIndex(J=>J.id===N.id),se[F]=q[F]+V,se)}(Y/n.current.getBoundingClientRect().width*100,E,x,C,y.current,h.current);W.some((z,Q)=>z!==ve[Q])&&u(ve)},[t]);c.useLayoutEffect(()=>{y.current.elements=t,y.current.panels=r,y.current.widths=a},[t,r,a]);const w=pi();c.useLayoutEffect(()=>{const{widths:P}=y.current;if(P.length===r.length)return;const g=w.get(r);if(g){const S=Ut(r,g,window.innerWidth);return void u(S)}const E=function(S){let x=S.length,C=100;const T=S.map(D=>D.defaultSize?(C-=D.defaultSize,x-=1,D.defaultSize):null),R=C/x;return T.map(D=>D===null?R:D)}(r);u(E)},[w,r]),c.useEffect(()=>{a.length&&w.setDebounced(r,a)},[w,r,a]),c.useLayoutEffect(()=>{const P=new ResizeObserver(()=>{const{panels:g,widths:E}=y.current,S=Ut(g,E,window.innerWidth);E.some((x,C)=>x!==S[C])&&u(S)});return P.observe(n.current),()=>{P.disconnect()}},[]);const j=c.useMemo(()=>({activeResizer:m,drag:f,getPanelStyle:l,registerElement:s,startDragging:v,stopDragging:b,unregisterElement:d}),[m,f,l,s,v,b,d]);return o.jsx(He.Provider,{value:j,children:o.jsx(hi,{ref:n,children:e})})};function pt(e){const{children:n,message:t,onRetry:i,onContinueAnyway:r,...a}=e,{t:u}=he(me),m=o.jsx(ue,{fontSize:1,mode:"ghost",onClick:i,text:u("error-card.retry-button.text")}),p=o.jsx(ue,{fontSize:1,mode:"ghost",tone:"critical",onClick:r,text:u("error-card.continue-button.text")});return o.jsx(Z,{height:"fill",...a,children:o.jsx(A,{align:"center",height:"fill",justify:"center",children:o.jsx(Bn,{padding:4,sizing:"border",width:0,children:o.jsxs(fe,{space:4,children:[o.jsxs(fe,{space:3,children:[o.jsx(O,{size:1,weight:"semibold",children:u("error-card.title")}),o.jsx(O,{muted:!0,size:1,children:t})]}),n,i&&r?o.jsxs(Vn,{space:2,children:[m,p]}):i?o.jsx(B,{children:m}):r?o.jsx(B,{children:p}):null]})})})})}function vi(e){const n=["comment","inspect","instruction","pathKey","rev","since","template","prefersLatestPublished","view"];return function(t={}){const i=Object.entries(t).map(([r,a])=>`${r}=${a}`).join("&");return i.length?`?${i}`:""}(Object.entries(e).filter(([t])=>n.includes(t)).reduce((t,[i,r])=>r==null?t:{...t,[i]:r},{}))}const gi=c.forwardRef(function(e,n){const{searchParams:t,...i}=e;return o.jsx(Fe,{...i,ref:n,state:{type:void 0,_searchParams:Object.entries(t)},title:void 0})}),yi=c.forwardRef(function(e,n){const{documentId:t,documentType:i,parentRefPath:r,template:a,searchParams:u,...m}=e;return o.jsx(Fe,{...m,ref:n,state:{id:t,type:i,_searchParams:Object.entries({...u,prefersLatestPublished:u.perspective==="published"?"true":void 0})},title:void 0})});function un(e){const{children:n,onStructureParams:t,structureParams:i,searchParams:r,refs:a}=e,{state:u,resolvePathFromState:m}=at(),p=qt(Object.fromEntries(u._searchParams||[])),y=c.useCallback(s=>`${m(u)}${vi({...p,...s})}`,[m,p,u]),l=c.useMemo(()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:s=>{const{childId:d,...h}=s,v=a==null?void 0:a.find(b=>b._id===d||ot(b._id)===d);return v?o.jsx(Fe,{...h,state:{id:d,type:v._type,_searchParams:Object.entries({...r,prefersLatestPublished:(r==null?void 0:r.perspective)==="published"?"true":void 0})}}):o.jsx("div",{...h})},BackLink:s=>o.jsx(gi,{...s,searchParams:r}),ReferenceChildLink:s=>o.jsx(yi,{...s,searchParams:r}),ParameterizedLink:()=>o.jsx(o.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:s=>{console.warn("handleEditReference",s)},replaceCurrent:s=>{console.warn("replaceCurrent",s)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:s=>{console.warn("duplicateCurrent",s)},setView:s=>{console.warn("setView",s)},setParams:s=>{var d;t({...s,inspect:(d=s.inspect)!=null?d:void 0})},setPayload:s=>{console.warn("setPayload",s)},navigateIntent:(s,d,h)=>{console.warn("navigateIntent",s,d,h)},createPathWithParams:y}),[y,t,a,r,i]);return o.jsx(dr.Provider,{value:l,children:n})}const bi=ne(Gt)`
  height: 100%;
`,xi=ne(A)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,wi=ne(Ae)`
  white-space: pre-wrap;
`;function ji(e){const{mainDocumentState:n,onStructureParams:t,searchParams:i,refs:r}=e,{t:a}=he(me),{devMode:u}=it(),m=c.useMemo(()=>r.filter(h=>{var v;return ot(h._id)!==((v=n==null?void 0:n.document)==null?void 0:v._id)}).map(h=>h._id),[n,r]),p=c.useMemo(()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:m}},schemaTypeName:"",title:a("document-list-pane.document-list.title"),type:"documentList"}),[m,a]),[y,l]=c.useState(null),s=c.useCallback(()=>l(null),[]),[d]=c.useState(()=>({}));return c.useEffect(()=>l(null),[r]),y?o.jsx(pt,{flex:1,message:a("document-list-pane.error.text"),onRetry:s,children:u&&o.jsx(Z,{overflow:"auto",padding:3,radius:2,tone:"critical",children:o.jsxs(fe,{space:3,children:[o.jsx(Le,{muted:!0,size:0,children:a("presentation-error.label")}),o.jsx(wi,{size:1,children:y.error.message})]})})}):o.jsx(Xt,{onCatch:l,children:o.jsx(bi,{children:o.jsx(Zt,{children:o.jsx(un,{onStructureParams:t,structureParams:d,searchParams:i,refs:r,children:o.jsx(xi,{direction:"column",flex:1,children:o.jsx(lr,{index:0,itemId:"$root",pane:p,paneKey:"$root"})})})})})})}const Pi=ne(Ae)`
  white-space: pre-wrap;
`;function Ei(e){const{documentId:n,documentType:t,onFocusPath:i,onStructureParams:r,searchParams:a,structureParams:u}=e,{template:m,templateParams:p}=u,{t:y}=he(me),{devMode:l}=it(),s=c.useMemo(()=>({id:n,options:{id:n,type:t,template:m,templateParameters:pr(p)},title:"",type:"document"}),[n,t,m,p]),[d,h]=c.useState(null),v=c.useCallback(()=>h(null),[]);return c.useEffect(()=>{h(null)},[n,t,u]),d?o.jsx(pt,{flex:1,message:y("document-pane.error.text"),onRetry:v,children:l&&o.jsx(Z,{overflow:"auto",padding:3,radius:2,tone:"critical",children:o.jsxs(fe,{space:3,children:[o.jsx(Le,{muted:!0,size:0,children:y("presentation-error.label")}),o.jsx(Pi,{size:1,children:d.error.message})]})})}):o.jsx(Xt,{onCatch:h,children:o.jsx(Gt,{style:{height:"100%"},children:o.jsx(un,{searchParams:a,onStructureParams:r,structureParams:u,children:o.jsx(fr,{paneKey:"document",index:1,itemId:"document",pane:s,onFocusPath:i})})})})}function Si(e){const{documentId:n,documentType:t,onFocusPath:i,onStructureParams:r,searchParams:a,structureParams:u}=e;return o.jsx(Zt,{children:o.jsx(Ei,{documentId:n,documentType:t,onFocusPath:i,onStructureParams:r,searchParams:a,structureParams:u})})}function ki(e){var n;const{documentId:t,documentType:i,mainDocumentState:r,onFocusPath:a,onStructureParams:u,refs:m,searchParams:p,structureParams:y}=e,{t:l}=he(me),s=tr(),d=c.useCallback(f=>o.jsx(Fe,{...f,state:{id:r.document._id,type:r.document._type,_searchParams:Object.entries({...p,prefersLatestPublished:(p==null?void 0:p.perspective)==="published"?"true":void 0})}}),[r,p]),h=c.useMemo(()=>{var f;return s.get(((f=r==null?void 0:r.document)==null?void 0:f._type)||"shoe")},[r,s]),v=function(f,w){const j=nr(),[P,g]=c.useState({});return c.useEffect(()=>{if(!w)return;const E=rr(j,w,f,"").subscribe(S=>{g(S)});return()=>{E==null||E.unsubscribe()}},[j,w,f]),P}(((n=r==null?void 0:r.document)==null?void 0:n._id)||"",h),b=c.useMemo(()=>r!=null&&r.document?o.jsx(ir,{...ar({value:r.document,published:v.published,draft:v.draft}),schemaType:h,status:o.jsx(Z,{padding:1,radius:2,shadow:1,children:o.jsx(O,{muted:!0,size:0,weight:"medium",children:l("main-document.label")})})}):null,[r,h,l,v]);return t&&i?o.jsx(Si,{documentId:t,documentType:i,onFocusPath:a,onStructureParams:u,searchParams:p,structureParams:y}):o.jsxs(A,{direction:"column",flex:1,height:"fill",children:[r&&o.jsx(Z,{padding:3,tone:r.document?"inherit":"caution",children:r.document?o.jsx(or,{__unstable_focusRing:!0,as:d,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:b}):o.jsx(Z,{padding:2,radius:2,tone:"inherit",children:o.jsxs(A,{gap:3,children:[o.jsx(B,{flex:"none",children:o.jsx(O,{size:1,children:o.jsx(sr,{})})}),o.jsx(B,{flex:1,children:o.jsx(O,{size:1,children:o.jsx(cr,{t:l,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:r.path}})})})]})})}),o.jsx(ji,{mainDocumentState:r,onStructureParams:u,searchParams:p,refs:m})]})}const Ci=ne.div`
  position: relative;
`,_i=ne.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&`
    /* Hover effect */
    & > span:nth-child(2) {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 9px;
      bottom: 0;
      background-color: var(--card-border-color);
      opacity: 0;
      transition: opacity 150ms;
    }

    @media (hover: hover) {
      &:hover > span:nth-child(2) {
        opacity: 0.2;
      }
    }
  `}
`,ln=function({id:e,order:n,disabled:t=!1}){const i=c.useRef(null),r=c.useContext(He);if(r===null)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(f){return c.useRef(f||De()).current}(e),{activeResizer:u,drag:m,startDragging:p,stopDragging:y,registerElement:l,unregisterElement:s}=r,d=u===a;if(r===null)throw Error("Panel components must be rendered within a PanelGroup container");const h=c.useCallback(f=>{p(a,f.nativeEvent)},[a,p]),v=c.useCallback(f=>{m(a,f)},[a,m]),b=c.useCallback(()=>{i.current.blur(),y()},[y]);return c.useEffect(()=>{if(!d||t)return;const f=function(){const w=document.body.style,j=document.documentElement.style,{cursor:P}=j,{userSelect:g}=w;return j.cursor="ew-resize",w.userSelect="none",()=>{P?j.cursor=P:j.removeProperty("cursor"),g?w.userSelect=g:w.removeProperty("user-select")}}();return window.addEventListener("mousemove",v),window.addEventListener("mouseup",b),window.addEventListener("contextmenu",b),()=>{f(),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",b),window.removeEventListener("contextmenu",b)}},[t,d,v,b]),c.useLayoutEffect(()=>(l(a,{id:a,order:n,type:"resizer",el:i}),()=>{s(a)}),[a,n,l,s]),o.jsx(Ci,{onMouseDown:h,ref:i,children:o.jsxs(_i,{$disabled:t,children:[o.jsx("span",{}),o.jsx("span",{})]})})},Ri=e=>{const{documentId:n,setDisplayedDocument:t,getCommentIntent:i}=e;return o.jsxs(o.Fragment,{children:[o.jsx(ln,{order:4}),o.jsx(dt,{id:"content",minWidth:325,order:5,children:o.jsx(mr,{documentId:n,setDisplayedDocument:t,children:o.jsx(ur,{getIntent:i,children:e.children})})})]})},Ii=e=>{const{documentId:n,documentsOnPage:t,documentType:i,getCommentIntent:r,mainDocumentState:a,onFocusPath:u,onStructureParams:m,searchParams:p,setDisplayedDocument:y,structureParams:l}=e;return o.jsx(Ri,{documentId:n,getCommentIntent:r,setDisplayedDocument:y,children:o.jsx(ki,{documentId:n,documentType:i,mainDocumentState:a,onFocusPath:u,onStructureParams:m,refs:t,searchParams:p,structureParams:l})})},$i=function(e){const{children:n,navigate:t}=e,i=c.useCallback((r,a=void 0)=>{t(a||{},r?{preview:r}:{})},[t]);return o.jsx(Hn.Provider,{value:i,children:n})};function Ti(e){const{unstable_navigator:n}=e,t=!(n==null||!n.component),[i,r]=function(p,y){const[l,s]=c.useState(()=>{var d;return JSON.parse((d=localStorage.getItem(p))!=null?d:JSON.stringify(y))});return c.useEffect(()=>{localStorage.setItem(p,JSON.stringify(l))},[p,l]),[l,s]}("presentation/navigator",t),a=!!t&&i,u=c.useMemo(()=>{if(t)return()=>r(p=>!p)},[t,r]),m=c.useCallback(function(){return o.jsx(o.Fragment,{children:a&&o.jsx(Di,{...n})})},[a,n]);return[{navigatorEnabled:a,toggleNavigator:u},m]}const Di=c.memo(function(e){const{minWidth:n,maxWidth:t,component:i}=e,r=n!=null&&t!=null&&n===t;return o.jsxs(o.Fragment,{children:[o.jsx(dt,{id:"navigator",minWidth:n,maxWidth:t,order:1,children:o.jsx(i,{})}),o.jsx(ln,{order:2,disabled:r})]})}),Oi=function(e){const{children:n,params:t}=e,i=c.useMemo(()=>t,[t]);return o.jsx(Kn.Provider,{value:i,children:n})},Li=function(e){const{children:n,devMode:t,name:i,navigate:r,params:a,searchParams:u,structureParams:m}=e,p=c.useMemo(()=>({devMode:t,name:i,navigate:r,params:a,searchParams:u,structureParams:m}),[t,i,r,a,u,m]);return o.jsx(qn.Provider,{value:p,children:n})},ft="ACTION_IFRAME_LOADED",nt="ACTION_IFRAME_REFRESH",rt="ACTION_IFRAME_RELOAD",dn="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",Ai=(e,n)=>{switch(n.type){case ft:return e.iframe.status==="loaded"?e:{...e,iframe:{...e.iframe,status:"loaded"}};case nt:return e.iframe.status==="refreshing"?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case rt:return e.iframe.status==="reloading"?e:{...e,iframe:{...e.iframe,status:"reloading"}};case dn:return zi(e,n);default:return e}},zi=(e,n)=>e.visualEditing.overlaysEnabled===n.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:n.enabled}},Mi=(Ze=lt(),Wt=!1,{...Ze,fallback:Wt,_run(e,n){return Ze._run(e,n),e.issues?{typed:!0,value:ai(this,e,n)}:e}}),Ui=function e(n,t){return{kind:"schema",type:"picklist",reference:e,expects:n.map(on).join(" | ")||"never",async:!1,options:n,message:t,_run(i,r){return this.options.includes(i.value)?i.typed=!0:we(this,"type",i,r),i}}}(["loading","loaded","refreshing","reloading"]),Wi=xe({mainDocument:Mi,iframe:xe({status:Ui}),visualEditing:xe({overlaysEnabled:lt()})}),Ni={mainDocument:!1,iframe:{status:"loading"},visualEditing:{overlaysEnabled:!1}};var Ze,Wt;function Fi(e){return oi(Wi,{...Ni,...e})}const Bi=Ht(ne.iframe`
  box-shadow: 0 0 0 1px var(--card-border-color);
  border-top: 1px solid transparent;
  border-bottom: 0;
  border-right: 0;
  border-left: 0;
  max-height: 100%;
  width: 100%;
`),Vi=ne(B)`
  position: absolute;
  inset: 0;
  background: transparent;
`,Hi=c.forwardRef(function(e,n){const{animate:t,initial:i,onLoad:r,preventClick:a,src:u,variants:m}=e;return o.jsxs(o.Fragment,{children:[o.jsx(Bi,{animate:t,initial:i,onLoad:r,ref:n,src:u,variants:m}),a&&o.jsx(Vi,{})]})}),Ki=function(e){var n;const{fontSize:t=1,onChange:i,origin:r,padding:a=3,prefix:u,suffix:m,value:p}=e,{t:y}=he(me),{basePath:l="/"}=((n=Jt())==null?void 0:n.activeWorkspace)||{},s=c.useRef(null),[d,h]=c.useState(void 0),[v,b]=c.useState(void 0),f=c.useCallback(g=>{h(g.currentTarget.value)},[]),w=c.useCallback(g=>{var E;if(g.key==="Enter"){if(d===void 0)return;const S=d.startsWith("/")||d===""?`${r}${d}`:d;if(!S.startsWith(r+"/")&&S!==r)return void b(y("preview-location-input.error",{origin:r,context:"missing-origin"}));if(!r&&(S.startsWith(`${l}/`)||S===l))return void b(y("preview-location-input.error",{basePath:l,context:"same-base-path"}));const x=S===r?r+"/":S;b(void 0),h(void 0),i(x.slice(r.length)),(E=s.current)==null||E.blur()}g.key==="Escape"&&(b(void 0),h(void 0))},[l,i,r,d,y]),j=c.useCallback(()=>{b(void 0),h(void 0)},[]);c.useEffect(()=>{b(void 0),h(void 0)},[r,p]);const P=c.useMemo(()=>({icon:Jn}),[]);return o.jsx(o.Fragment,{children:o.jsx(Gn,{clearButton:v?P:void 0,customValidity:v,fontSize:t,onBlur:j,onClear:()=>{b(void 0),h(r+p)},onChange:f,onKeyDownCapture:w,padding:a,prefix:u,style:{zIndex:1},radius:2,ref:s,space:a,suffix:m,value:d===void 0?`${r}${p}`:d})})};function qi(e){const{initialUrl:n,openPopup:t,previewLocationOrigin:i,previewLocationRoute:r}=e,{t:a}=he(me),u=c.useCallback(m=>{m.preventDefault(),t(m.currentTarget.href)},[t]);return o.jsxs(o.Fragment,{children:[o.jsx(Ji,{initialUrl:n,previewLocationOrigin:i,previewLocationRoute:r}),o.jsx(Oe,{icon:Xn,text:a("share-url.menu-item.open.text"),as:"a",href:`${i}${r}`,onClick:u,rel:"opener",target:"_blank"})]})}function Ji(e){const{initialUrl:n,previewLocationOrigin:t,previewLocationRoute:i}=e,{t:r}=he(me),{push:a}=Zn(),u=ze({apiVersion:Me}),m=et(),[p,y]=c.useState(!1);return o.jsx(Oe,{disabled:p,onClick:()=>{if(navigator==null||!navigator.clipboard)return a({closable:!0,status:"error",title:r("share-url.clipboard.status",{context:"unsupported"})}),!1;let l;y(!0);const s=`${t}${i}`,d=()=>{a({id:l,closable:!0,status:"success",title:r("share-url.clipboard.status",{context:"success"})}),y(!1)},h=v=>{a({closable:!0,status:"error",title:r("share-url.clipboard.status",{context:"failed"}),description:v.message||v.toString()}),y(!1)};if(Or(n)){const v=async()=>{l=a({closable:!0,title:r("share-url.clipboard.status",{context:"copying"})});const b=await nn(u,"@sanity/presentation",typeof window>"u"?"":location.href,m==null?void 0:m.id);return Lr(n,b.secret,i).toString()};if(typeof ClipboardItem<"u"){const b="text/plain",f=new ClipboardItem({[b]:v().then(w=>new Blob([w],{type:b}))});navigator.clipboard.write([f]).then(d).catch(h)}else v().then(b=>navigator.clipboard.writeText(b)).then(d).catch(h)}else navigator.clipboard.writeText(s).then(d).catch(h)},text:r("share-url.menu-item.copy.text"),icon:Yn})}const Ye=Ht(A),Qe={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},Gi="caution",Xi="positive",Nt={previewDrafts:Qn,published:er},Zi=c.forwardRef(function(e,n){const{dispatch:t,iframe:i,initialUrl:r,loadersConnection:a,navigatorEnabled:u,onPathChange:m,onRefresh:p,openPopup:y,overlaysConnection:l,perspective:s,previewUrl:d,setPerspective:h,setViewport:v,targetOrigin:b,toggleNavigator:f,toggleOverlay:w,viewport:j,visualEditing:{overlaysEnabled:P}}=e,{t:g}=he(me),{devMode:E}=it(),S=Sn(),x=c.useCallback(()=>v(j==="desktop"?"mobile":"desktop"),[v,j]),C=i.status==="loading"||i.status==="reloading",[T,R]=c.useState(!1),D=i.status==="refreshing",[Y,W]=c.useState(!1),ve=C||D||l==="connecting",z=c.useMemo(()=>b===location.origin?"":b,[b]),Q=c.useCallback(()=>{p(()=>{typeof n=="function"||n==null||!n.current||(t({type:rt}),n.current.src=`${b}${d||"/"}`)})},[t,p,d,b,n]),re=c.useCallback(()=>{typeof n=="function"||n==null||!n.current||(n.current.src=r.toString(),t({type:rt}))},[t,n,r]),ee=c.useCallback(()=>{le(!0)},[]),[te,le]=c.useState(!1),[H,oe]=c.useState(!1);c.useEffect(()=>{if(!(C||D||l!=="connecting"&&l!=="reconnecting")){const N=setTimeout(()=>{oe(!0)},1e3);return()=>clearTimeout(N)}},[l,C,D]),c.useEffect(()=>{if(!C&&!D&&H){if(l==="connected"&&(W(!1),oe(!1),R(!1),le(!1)),l==="connecting"){const N=setTimeout(()=>{R(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")},bt);return()=>clearTimeout(N)}if(l==="reconnecting"){const N=setTimeout(()=>{R(!0),W(!0)},bt);return()=>clearTimeout(N)}l==="disconnected"&&W(!0)}},[C,l,D,H]);const ge=c.useMemo(()=>{const N=new URL(d||"/",b),{pathname:F,search:J}=Dr(N);return`${F}${J}`},[d,b]),q=c.useCallback(()=>{t({type:ft})},[t]);c.useEffect(()=>{if(typeof n=="function"||n==null||!n.current)return;const N=n.current;function F(){N===document.activeElement&&N.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",F),()=>{window.removeEventListener("blur",F)}},[n]);const se=c.useMemo(()=>(C||l==="connecting"&&i.status!=="refreshing")&&!te,[te,i.status,C,l]),V=c.useMemo(()=>[se?"background":"active",C?"reloading":"idle",j,H&&!te?"timedOut":""],[te,C,se,H,j]);return o.jsx(vr,{transition:S?{duration:0}:void 0,children:o.jsxs(kn,{delay:1e3,children:[o.jsx(Z,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:o.jsxs(A,{align:"center",style:{minHeight:0},children:[f&&o.jsx(B,{flex:"none",marginRight:1,padding:1,children:o.jsx(Re,{animate:!0,content:o.jsx(O,{size:1,children:g("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(ue,{"aria-label":g("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:Cn,mode:"bleed",onClick:f,padding:2,selected:u})})}),o.jsx(Re,{animate:!0,content:o.jsxs(A,{align:"center",style:{whiteSpace:"nowrap"},children:[o.jsx(B,{padding:1,children:o.jsx(O,{size:1,children:g("preview-frame.overlay.toggle-button.tooltip",{context:P?"disable":"enable"})})}),o.jsx(B,{paddingY:1,children:o.jsx(_n,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:o.jsx(Z,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:P?"transparent":void 0,children:o.jsxs(A,{align:"center",gap:3,children:[o.jsx("div",{style:{margin:-4},children:o.jsx(Rn,{checked:P,onChange:w,disabled:i.status==="loading"||l!=="connected"})}),o.jsx(B,{children:o.jsx(O,{muted:!P,size:1,weight:"medium",children:g("preview-frame.overlay.toggle-button.text")})})]})})}),o.jsx(B,{flex:1,marginX:1,children:o.jsx(Ki,{prefix:o.jsx(B,{padding:1,children:o.jsx(Re,{animate:!0,content:o.jsx(O,{size:1,children:i.status==="loaded"?g("preview-frame.refresh-button.tooltip"):g("preview-frame.status",{context:i.status})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(ue,{"aria-label":g("preview-frame.refresh-button.aria-label"),fontSize:1,icon:In,mode:"bleed",loading:i.status==="reloading"||i.status==="refreshing",onClick:Q,padding:2})})}),onChange:m,origin:z,suffix:o.jsx(B,{padding:1,children:o.jsx(xt,{button:o.jsx(ue,{fontSize:1,iconRight:$n,mode:"bleed",padding:2,space:2}),id:"location-menu",menu:o.jsx(wt,{children:o.jsx(qi,{initialUrl:r,openPopup:y,previewLocationOrigin:z,previewLocationRoute:ge})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),value:ge})}),o.jsx(A,{align:"center",flex:"none",gap:1,padding:1,children:o.jsx(xt,{button:o.jsx(ue,{fontSize:1,iconRight:Tn,mode:"bleed",padding:2,space:2,text:g(Qe[a==="connected"?s:"previewDrafts"]),loading:a==="reconnecting"&&i.status!=="loaded",disabled:a!=="connected"}),id:"perspective-menu",menu:o.jsxs(wt,{style:{maxWidth:240},children:[o.jsx(Oe,{fontSize:1,onClick:()=>h("previewDrafts"),padding:3,pressed:s==="previewDrafts",tone:Gi,children:o.jsxs(A,{align:"flex-start",gap:3,children:[o.jsx(B,{flex:"none",children:o.jsx(O,{size:1,children:c.createElement(Nt.previewDrafts)})}),o.jsxs(fe,{flex:1,space:2,children:[o.jsx(O,{size:1,weight:"medium",children:g(Qe.previewDrafts)}),o.jsx(O,{muted:!0,size:1,children:g("preview-frame.perspective.previewDrafts.text")})]}),o.jsx(B,{flex:"none",children:o.jsx(O,{muted:!0,size:1,style:{opacity:s==="previewDrafts"?1:0},children:o.jsx(jt,{})})})]})}),o.jsx(Oe,{fontSize:1,onClick:()=>h("published"),padding:3,pressed:s==="published",tone:Xi,children:o.jsxs(A,{align:"flex-start",gap:3,children:[o.jsx(B,{flex:"none",children:o.jsx(O,{size:1,children:c.createElement(Nt.published)})}),o.jsxs(fe,{flex:1,space:2,children:[o.jsx(O,{size:1,weight:"medium",children:g(Qe.published)}),o.jsx(O,{muted:!0,size:1,children:g("preview-frame.perspective.published.text")})]}),o.jsx(B,{flex:"none",children:o.jsx(O,{muted:!0,size:1,style:{opacity:s==="published"?1:0},children:o.jsx(jt,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),o.jsx(A,{align:"center",flex:"none",gap:1,children:o.jsx(Re,{animate:!0,content:o.jsx(O,{size:1,children:g("preview-frame.viewport-button.tooltip",{context:j==="desktop"?"narrow":"full"})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:o.jsx(ue,{"aria-label":g("preview-frame.viewport-button.aria-label"),fontSize:1,icon:j==="desktop"?Dn:On,mode:"bleed",onClick:x,padding:2})})})]})}),o.jsx(Z,{flex:1,tone:"transparent",children:o.jsxs(A,{align:"center",height:"fill",justify:"center",padding:j==="desktop"?0:2,sizing:"border",style:{position:"relative",cursor:ve?"wait":void 0},children:[o.jsx(Ln,{children:Y||C||D||!H||te?(C||l==="connecting"&&i.status!=="refreshing")&&!te?o.jsx(Ye,{initial:"initial",animate:"animate",exit:"exit",variants:Ft,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:o.jsxs(A,{style:{...Ne[j]},justify:"center",align:"center",direction:"column",gap:4,children:[o.jsx(Pt,{muted:!0}),o.jsx(O,{muted:!0,size:1,children:g("preview-frame.status",{context:"loading"})})]})}):Y&&!te?o.jsx(Ye,{initial:"initial",animate:"animate",exit:"exit",variants:Yi,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:o.jsx(pt,{flex:1,message:g("preview-frame.connection.error.text"),onRetry:re,onContinueAnyway:ee,children:E&&o.jsxs(o.Fragment,{children:[l!=="connected"&&o.jsx(Z,{padding:3,radius:2,tone:"critical",children:o.jsxs(fe,{space:3,children:[o.jsx(Le,{muted:!0,size:0,children:g("preview-frame.overlay.connection-status.label")}),o.jsx(Ae,{size:1,children:g("channel.status",{context:l})})]})}),a!=="connected"&&o.jsx(Z,{padding:3,radius:2,tone:"critical",children:o.jsxs(fe,{space:3,children:[o.jsx(Le,{muted:!0,size:0,children:g("preview-frame.loader.connection-status.label")}),o.jsx(Ae,{size:1,children:g("channel.status",{context:a})})]})})]})})}):null:o.jsx(Ye,{initial:"initial",animate:"animate",exit:"exit",variants:Ft,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:T?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:T?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:o.jsxs(A,{style:{...Ne[j]},justify:"center",align:"center",direction:"column",gap:4,children:[T&&o.jsx(ue,{disabled:!0,fontSize:1,mode:"ghost",text:g("preview-frame.continue-button.text"),style:{opacity:0}}),o.jsx(Z,{radius:2,tone:T?"caution":"inherit",padding:4,shadow:1,children:o.jsxs(A,{justify:"center",align:"center",direction:"column",gap:4,children:[o.jsx(Pt,{muted:!0}),o.jsx(O,{muted:!0,size:1,children:g("preview-frame.status",T?{context:"timeout"}:{context:"connecting"})})]})}),T&&o.jsx(ue,{fontSize:1,tone:"critical",onClick:ee,text:g("preview-frame.continue-button.text")})]})})}),o.jsx(Hi,{animate:V,initial:["background"],onLoad:q,preventClick:se,ref:n,src:r.toString(),variants:Qi})]})})]})})}),Ne={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Ft={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Yi={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Qi={desktop:{...Ne.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Ne.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};let Bt=!1;function Vt(e,n){return e instanceof Function?e(n):e}function ea(e,n){const t=Array.isArray(e)?e:[e];for(e of t){let i,r=e;if(typeof e=="string")try{const a=new URL(e);i=a.origin,r=a.pathname}catch{}if(!i||n.origin===i)try{const a=Mr(r,{decode:decodeURIComponent})(n.pathname);if(a){const{params:u,path:m}=a;return{origin:i,params:u,path:m}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function ta(e){const{navigate:n,navigationHistory:t,path:i,previewUrl:r,resolvers:a=[]}=e,{state:u}=at(),m=ze({apiVersion:Me}),[p,y]=c.useState(void 0),l=c.useRef(void 0),s=c.useMemo(()=>{var h,v;const b=i||((v=(h=u._searchParams)==null?void 0:h.find(([w])=>w==="preview"))==null?void 0:v[1])||"",f=typeof r=="string"?r:typeof r=="object"&&(r==null?void 0:r.origin)||location.origin;return new URL(b,f)},[i,r,u._searchParams]),d=c.useCallback(()=>{y(void 0),l.current=void 0},[]);return c.useEffect(()=>{if(a.length&&s){let j;for(const P of a){const g=ea(P.route,s);if(g){j={context:g,resolver:P};break}}if(j){const P=function(E,S){var x;if(E.resolve){const C=(x=E.resolve(S))==null?void 0:x.filter;return C?`*[${C}][0]{_id, _type}`:void 0}return"type"in E?`*[_type == "${E.type}"][0]{_id, _type}`:`*[${Vt(E.filter,S)}][0]{_id, _type}`}(j.resolver,j.context),g=(h=j.resolver,v=j.context,h.resolve?(f=(b=h.resolve(v))==null?void 0:b.params)!=null?f:v.params:"type"in h?{}:(w=Vt(h.params,v))!=null?w:v.params);if(P){const E=new AbortController,S={perspective:"previewDrafts",signal:E.signal};return m.fetch(P,g,S).then(x=>{var C,T;(!x||l.current!==x._id)&&(y({document:x,path:s.pathname}),l.current=x==null?void 0:x._id,((C=t.at(-1))==null?void 0:C.id)===((T=t.at(-2))==null?void 0:T.id)&&(n==null||n({id:x==null?void 0:x._id,type:x==null?void 0:x._type})))}).catch(x=>{x instanceof Error&&x.name==="AbortError"||(y({document:void 0,path:s.pathname}),l.current=void 0)}),()=>{E.abort()}}}}var h,v,b,f,w;d()},[m,d,n,t,a,s]),p}function na(e){var n;if(e===void 0)return;const t=(n=decodeURIComponent(e))==null?void 0:n.split(".");return t[0]==="drafts"&&t.shift(),t.join(".")}function ra(e){if(e!==void 0)return en.toString(function(n){const t=[];for(const i of n.split(".")){const r=si.exec(i);if(r){t.push(r[1],Number(r[2]));continue}const a=ci.exec(i);if(a){t.push(a[1],[Number(a[2]),Number(a[3])]);continue}const u=ui.exec(i);u?t.push(u[1],{_key:u[2]}):t.push(i)}return t}(decodeURIComponent(e)))}function Te(e){return Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0&&n!==""&&n!==null))}function ia({initialPreviewUrl:e,routerNavigate:n,routerState:t,routerSearchParams:i,frameStateRef:r}){const a=c.useMemo(()=>{const{id:s,path:d,type:h}={id:na((v=t).id),path:ra(v.path),type:v.type};var v;return{id:s,type:h,path:d,preview:i.preview||`${e.pathname}${e.search}`,perspective:i.perspective,viewport:i.viewport,inspect:i.inspect,rev:i.rev,prefersLatestPublished:i.prefersLatestPublished,since:i.since,template:i.template,templateParams:i.templateParams,view:i.view,pathKey:i.pathKey,instruction:i.instruction,comment:i.comment}},[t,i,e]),u=c.useMemo(()=>Te({inspect:a.inspect,path:a.path,rev:a.rev,prefersLatestPublished:a.prefersLatestPublished,since:a.since,template:a.template,templateParams:a.templateParams,view:a.view,pathKey:a.pathKey,instruction:a.instruction,comment:a.comment}),[a.comment,a.inspect,a.instruction,a.path,a.pathKey,a.prefersLatestPublished,a.rev,a.since,a.template,a.templateParams,a.view]),m=c.useMemo(()=>Te({perspective:a.perspective,preview:a.preview,viewport:a.viewport}),[a.perspective,a.preview,a.viewport]),p=c.useRef(t);c.useEffect(()=>{p.current=t},[t]);const[y,l]=c.useState([t]);return{navigate:c.useCallback((s,d={},h)=>{s.id&&(s.id=ot(s.id));const{_searchParams:v,...b}=p.current,f=(v||[]).reduce((g,[E,S])=>(g[E]=S,g),{}),w=Te({...b,...s}),j=Te({...f,...d});b.id!==w.id&&(delete j.template,delete j.templateParams),w._searchParams=Object.entries(j).reduce((g,[E,S])=>[...g,[E,S]],[]);const P=h??j.preview===r.current.url;l(g=>[...g,w]),n(w,{replace:P})},[n,r]),navigationHistory:y,params:a,searchParams:m,structureParams:u}}function aa(e,n,t){var i,r;const a=ze({apiVersion:Me}),u=Jt(),m=((i=u==null?void 0:u.activeWorkspace)==null?void 0:i.basePath)||"/",p=((r=u==null?void 0:u.activeWorkspace)==null?void 0:r.name)||"default",y=function(s,d,h,v){const[b,f]=c.useState(()=>v||""),w=c.useRef(0);c.useEffect(()=>{if(b&&v)return window.clearTimeout(w.current),()=>{w.current=window.setTimeout(()=>{f("")},100)}},[b,v]);const j=et();return c.useMemo(()=>["@sanity/presentation",d,h,s,j==null?void 0:j.id,oa,b],[d,j==null?void 0:j.id,s,h,b])}(n,m,p,t),l=function(s,d){const h=ze({apiVersion:Me}),v=et(),[b,f]=c.useState(""),w=s?_t(async()=>await nn(h,"@sanity/presentation",typeof window>"u"?"":location.href,v==null?void 0:v.id),[...d,b]):null;return c.useEffect(()=>{if(!w)return;const j=setTimeout(()=>{c.startTransition(()=>f(w.expiresAt.toString()))},w.expiresAt.getTime()-Date.now());return()=>clearTimeout(j)},[w]),(w==null?void 0:w.secret)||null}(typeof e=="object"||typeof e=="function",y);return _t(async()=>{if(typeof e=="string"){const d=new URL(e,location.origin);let h=d;try{if(t){const v=new URL(t,d);v.origin===d.origin&&(h=v)}else if(document.referrer){const v=new URL(document.referrer);v.origin===d.origin&&(h=v)}}catch{}return location.origin!==h.origin||!h.pathname.startsWith(`${m}/`)&&h.pathname!==m?h:d}const s=await(typeof e=="object"?Vr(e):e)({client:a,previewUrlSecret:l,previewSearchParam:t,referrer:typeof document>"u"?null:document.referrer,studioBasePath:m});return new URL(s,location.origin)},[...y,l])}const oa=Symbol(),sa=c.lazy(()=>Kt(()=>import("./LoaderQueries-12b636f1.js"),["static/LoaderQueries-12b636f1.js","static/sanity-8654a3cc.js","static/DisplayedDocumentBroadcaster-67147568.js"])),ca=c.lazy(()=>Kt(()=>import("./PostMessageRefreshMutations-5c5f8215.js"),["static/PostMessageRefreshMutations-5c5f8215.js","static/sanity-8654a3cc.js"])),ua=ne(A)`
  overflow-x: auto;
`;function la(e){var n,t,i,r;const{previewUrl:a,components:u}=(n=e.tool.options)!=null?n:{},m=e.tool.name||An,{unstable_navigator:p}=u||{},{navigate:y,state:l}=at(),s=qt(Object.fromEntries(l._searchParams||[])),d=aa(a||"/",m,s.preview||null),[h]=c.useState(()=>{var _;const I=(_=e.tool.options)==null?void 0:_.devMode;return typeof I=="function"?I():typeof I=="boolean"?I:typeof window<"u"&&window.location.hostname==="localhost"}),v=c.useMemo(()=>d.origin,[d.origin]),b=c.useRef(null),[f,w]=c.useState(),[j,P]=c.useState({}),g=c.useRef({title:void 0,url:void 0}),{navigate:E,navigationHistory:S,params:x,searchParams:C,structureParams:T}=ia({initialPreviewUrl:d,routerNavigate:y,routerState:l,routerSearchParams:s,frameStateRef:g}),R=c.useMemo(()=>sn(E,50),[E]),[D,Y]=c.useReducer(Ai,{},Fi),W=c.useMemo(()=>x.perspective?"published":"previewDrafts",[x.perspective]),ve=c.useMemo(()=>x.viewport?"mobile":"desktop",[x.viewport]),[z,Q]=function(_,I){if(_!=="published"&&_!=="previewDrafts")throw new Error(`Invalid perspective: ${_}`);const[L,$]=c.useState({}),[k,G]=c.useState({}),K=c.useRef(""),Pe=c.useCallback((de,M,pe=[])=>{const X=pe.filter(ae=>"_projectId"in ae&&ae._projectId?(Bt||(console.warn("Cross dataset references are not supported yet, ignoring source document",ae),Bt=!0),!1):ae);(M==="published"?$:G)(ae=>{const Ee={};for(const _e of X)Ee[_e._id]=_e;if(K.current!==I.current.url)return K.current=I.current.url,{[de]:Ee};const Ce=ae[de];return hr(Ce,Ee)?ae:{...ae,[de]:Ee}})},[I]);return[c.useMemo(()=>{const de=Object.values(_==="published"?L:k).reduce((M,pe)=>(Object.values(pe).forEach(X=>{M[X._id]=X}),M),{});return Object.values(de)},[_,k,L]),Pe]}(W,g),re=zn(),ee=Mn(),te=ta({navigate:E,navigationHistory:S,path:x.preview,previewUrl:(t=e.tool.options)==null?void 0:t.previewUrl,resolvers:(r=(i=e.tool.options)==null?void 0:i.resolve)==null?void 0:r.mainDocuments}),[le,H]=c.useState("connecting"),[oe,ge]=c.useState("connecting"),[q,se]=c.useState("connecting"),[V]=c.useState(()=>new Set),N=c.useCallback(_=>{const I=window.open(_,"_blank");I&&V.add(I)},[V]);c.useEffect(()=>{if(V.size&&f)for(const _ of V)_&&"closed"in _&&!_.closed&&f.addSource(_)},[f,V,V.size]);const F=c.useRef(W);c.useEffect(()=>{F.current=W},[W]),c.useEffect(()=>{var _;const I=(_=b.current)==null?void 0:_.contentWindow;if(!I)return;const L=function($){const{destroy:k,send:G}=$t($),K=new Set,Pe=new WeakMap,de=new Set;return{destroy:()=>{k();for(const M of de)M()},send:(M,...pe)=>{G(M,...pe);for(const X of K)X&&"closed"in X&&!X.closed&&Pe.has(X)&&Pe.get(X)(M,...pe)},addSource(M){if(K.has(M))return;if(!("closed"in M))throw console.warn("Source is unsupported",{source:M}),new Error("Source is unsupported");if(M.closed)throw new Error("Source is closed");const{send:pe,destroy:X}=$t({...$,target:M,connectTo:$.connectTo.map(ae=>{const{onStatusUpdate:Ee,onEvent:Ce,..._e}=ae;return{..._e,onEvent:Ce?(...gt)=>{const[qe]=gt;if(qe!=="preview-kit/documents"&&qe!=="overlay/navigate"&&qe!=="loader/documents")return Ce(...gt)}:void 0}})});de.add(X),Pe.set(M,pe),K.add(M)}}}({id:"presentation",target:I,targetOrigin:v,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:H,onEvent($,k){if($!=="visual-editing/focus"&&$!=="overlay/focus"||!("id"in k))if($==="visual-editing/navigate"||$==="overlay/navigate"){const{title:G,url:K}=k;g.current.url!==K&&R({},{preview:K}),g.current={title:G,url:K}}else $==="visual-editing/meta"?g.current.title=k.title:$==="visual-editing/toggle"||$==="overlay/toggle"?Y({type:dn,enabled:k.enabled}):$==="visual-editing/documents"?Q("visual-editing",k.perspective,k.documents):$==="visual-editing/refreshing"&&k.source==="manual"?clearTimeout(mt.current):$==="visual-editing/refreshing"&&k.source==="mutation"?Y({type:nt}):$==="visual-editing/refreshed"&&Y({type:ft});else R({type:k.type,id:k.id,path:k.path},{prefersLatestPublished:"isDraft"in k||F.current==="previewDrafts"?void 0:"true"})}},{id:"loaders",heartbeat:!0,onStatusUpdate:ge,onEvent($,k){if($==="loader/documents"&&k.projectId===re&&k.dataset===ee)Q("loaders",k.perspective,k.documents);else if($==="loader/query-listen"&&k.projectId===re&&k.dataset===ee){if(typeof k.heartbeat=="number"&&k.heartbeat<Je)throw new Error(`Loader query listen heartbeat interval must be at least ${Je}ms`);P(G=>{var K;return{...G,[li(k.query,k.params)]:{perspective:k.perspective,query:k.query,params:k.params,receivedAt:Date.now(),heartbeat:(K=k.heartbeat)!=null&&K}}})}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:se,onEvent($,k){$==="preview-kit/documents"&&k.projectId===re&&k.dataset===ee&&Q("preview-kit",k.perspective,k.documents)}}]});return w(L),()=>{L.destroy(),w(void 0)}},[ee,re,Q,R,v]),c.useEffect(()=>{const _=setInterval(()=>P(I=>{if(Object.keys(I).length<1)return I;const L=Date.now();if(!Object.values(I).some(k=>k.heartbeat!==!1&&L>k.receivedAt+k.heartbeat))return I;const $={};for(const[k,G]of Object.entries(I))G.heartbeat!==!1&&L>G.receivedAt+G.heartbeat||($[k]=G);return $}),Je);return()=>clearInterval(_)},[]);const J=c.useCallback(_=>{R({path:en.toString(_)},{},!0)},[R]),ie=c.useCallback(_=>{const I=new URL(_,d.origin),L=I.pathname+I.search;I.origin===d.origin&&L!==x.preview&&R({},{preview:L})},[d,x,R]),ce=c.useCallback(_=>{R({},{..._,prefersLatestPublished:void 0})},[R]);c.useEffect(()=>{f==null||f.send("overlays","presentation/perspective",{perspective:W})},[f,W]),c.useEffect(()=>{x.id&&x.path?f==null||f.send("overlays","presentation/focus",{id:x.id,path:x.path}):f==null||f.send("overlays","presentation/blur",void 0)},[f,x.id,x.path]);const ke=c.useRef(void 0);c.useEffect(()=>{W==="published"&&x.id&&x.id!==ke.current&&!x.rev&&!x.prefersLatestPublished&&R({},{prefersLatestPublished:"true"},!0),ke.current=x.id},[R,x.id,x.prefersLatestPublished,x.rev,W]),c.useEffect(()=>{g.current.url&&x.preview&&g.current.url!==x.preview&&(g.current.url=x.preview,le!=="connected"&&b.current?b.current.src=`${v}${x.preview}`:f==null||f.send("overlays","presentation/navigate",{url:x.preview,type:"replace"}))},[f,le,v,x.preview]);const je=c.useCallback(()=>f==null?void 0:f.send("overlays","presentation/toggleOverlay",void 0),[f]),[pn,fn]=c.useState(null);c.useEffect(()=>{const _=L=>{Dt(L)&&je()},I=L=>{var $;Dt(L)&&je(),$=L,["mod","\\"].every(k=>Tt[k]?$[Tt[k]]:$.key===k.toUpperCase())&&je()};return window.addEventListener("keydown",I),window.addEventListener("keyup",_),()=>{window.removeEventListener("keydown",I),window.removeEventListener("keyup",_)}},[je]);const[hn,mn]=c.useState(null),[{navigatorEnabled:ht,toggleNavigator:vn},gn]=Ti({unstable_navigator:p}),Ke=c.useRef(x.id);c.useEffect(()=>{x.rev&&Ke.current&&x.id!==Ke.current&&R({},{rev:void 0}),Ke.current=x.id});const mt=c.useRef(),yn=c.useCallback(_=>{if(Y({type:nt}),f)return mt.current=window.setTimeout(_,300),void f.send("overlays","presentation/refresh",{source:"manual",livePreviewEnabled:q==="connected"||oe==="connected"});_()},[f,oe,q]),vt=Un(),bn=c.useCallback(({id:_,type:I,path:L})=>{if(g.current.url)return{title:g.current.title||g.current.url,name:"edit",params:{id:_,path:L,type:I,inspect:Wn,workspace:vt.name,mode:Nn,preview:x.preview}}},[x.preview,vt.name]),xn=c.useCallback(_=>{R({},{viewport:_==="desktop"?void 0:"mobile"},!0)},[R]),wn=c.useCallback(_=>{R({},{perspective:_==="previewDrafts"?void 0:_})},[R]);return o.jsxs(o.Fragment,{children:[o.jsx(Li,{devMode:h,name:m,navigate:R,params:x,searchParams:C,structureParams:T,children:o.jsx($i,{navigate:R,children:o.jsx(Oi,{params:x,children:o.jsx(ua,{height:"fill",children:o.jsxs(mi,{children:[o.jsx(gn,{}),o.jsx(dt,{id:"preview",minWidth:325,defaultSize:ht?50:75,order:3,children:o.jsx(A,{direction:"column",flex:1,height:"fill",ref:mn,children:o.jsx(Fn,{element:hn,children:o.jsx(Zi,{dispatch:Y,iframe:D.iframe,initialUrl:d,loadersConnection:oe,navigatorEnabled:ht,onPathChange:ie,onRefresh:yn,openPopup:N,overlaysConnection:le,previewUrl:x.preview,perspective:W,ref:b,setPerspective:wn,setViewport:xn,targetOrigin:v,toggleNavigator:vn,toggleOverlay:je,viewport:ve,visualEditing:D.visualEditing})})})}),o.jsx(Ii,{documentId:x.id,documentsOnPage:z,documentType:x.type,getCommentIntent:bn,mainDocumentState:te,onFocusPath:J,onStructureParams:ce,searchParams:C,setDisplayedDocument:fn,structureParams:T})]})})})})}),f&&o.jsx(c.Suspense,{children:o.jsx(sa,{channel:f,liveQueries:j,perspective:W,liveDocument:pn,documentsOnPage:z})}),f&&x.id&&x.type&&o.jsx(c.Suspense,{children:o.jsx(ca,{channel:f,id:x.id,type:x.type,loadersConnection:oe,previewKitConnection:q})})]})}const va=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"}));export{Et as D,va as P,br as a,fa as g,ha as p,ma as r,xr as t,Ge as w};
